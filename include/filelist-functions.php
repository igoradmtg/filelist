<?php
$strHtmStartMain='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style>
body,td, input, select {
	margin-left: 0px;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 0px;
	font-family:Verdana, Arial, Helvetica, sans-serif; 
	font-size: 11px;
}
</style>
<title>'.$title.'</title></head>
<body>';
$strHtmEndMain='</body></html>';

$strHtmStart='<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>'.$title1.'</title>
<META name="description" content="Учебники, справочники, обучение C++, 1С:Предприятие 8.1">
<META name="keywords" content="OpenOffice.org Calc Writer Impress Math Microsoft Word 2007 Microsoft Excel 2007 Microsoft Windows XP Windows Vista учебники справочники литература обучение сертификация аттестация программы офисные приложения офис программы для офиса MS Word 2003 MS Excel 2003 MS Office 2003 Windows XP Windows Vista тестирование сертификация аттестация оценка персонала Центр тестирования сертификации Профессионал">
<link href="printable.css" type="text/css" rel="stylesheet">
</head>
<body leftmargin="6" topmargin="6" rightmargin="6" bottommargin="6" marginwidth="6" marginheight="6">
<!-- REKLAMA -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100"><table width="100" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td bgcolor="#00006A">&nbsp;</td>
          <td bgcolor="#00009B">&nbsp;</td>
          <td bgcolor="#0000CC">&nbsp;</td>
          <td bgcolor="#1111FF">&nbsp;</td>
          <td bgcolor="#5151FF">&nbsp;</td>
          <td bgcolor="#6F6FFF">&nbsp;</td>
          <td bgcolor="#9191FF">&nbsp;</td>
          <td bgcolor="#9F9FFF">&nbsp;</td>
          <td bgcolor="#B0B0FF">&nbsp;</td>
          <td bgcolor="#C4C4FF">&nbsp;</td>
        </tr>
      </table></td>
    <td align="center" bgcolor="#CCCCFF"><script language="javascript">
var str2;
var now = 0;
var ar=new Array("Сертификация&nbsp;специалистов",
"Аттестация&nbsp;персонала",
"Найди&nbsp;работу&nbsp;с&nbsp;сертификатом&nbsp;Профессионал",
"Центр&nbsp;тестирования&nbsp;on-line",
"Бесплатное&nbsp;тестирование&nbsp;MS&nbsp;Excel&nbsp;2007",
"Пройди&nbsp;тест&nbsp;MS&nbsp;Exсel2007&nbsp;и&nbsp;получи&nbsp;сертификат",
"Пройди&nbsp;тест&nbsp;MS&nbsp;Word&nbsp;2007&nbsp;и&nbsp;получи&nbsp;сертификат",
"Получи&nbsp;сертификат&nbsp;специалиста&nbsp;MS&nbsp;Excel&nbsp;2007",
"Получи&nbsp;сертификат&nbsp;специалиста&nbsp;MS&nbsp;Word&nbsp;2007",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Платформа&nbsp;8.1",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Бухгалтерия&nbsp;8",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Управление&nbsp;торговлей&nbsp;8",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Бухгалтерия&nbsp;7.7",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Торговля&nbsp;и&nbsp;склад&nbsp;7.7",
"Проведите&nbsp;аттестацию&nbsp;своего&nbsp;персонала",
"Бесплатное&nbsp;тестирование&nbsp;при&nbsp;приеме&nbsp;на&nbsp;работу",
"Получи&nbsp;сертификат&nbsp;&quot;Профессионал&quot;&nbsp;и&nbsp;зарабатывай&nbsp;больше",
"Хочешь&nbsp;зарабатывать&nbsp;больше.&nbsp;Получи&nbsp;сертификат&nbsp;&quot;Профессионал&quot;"
);
now = Math.round(Math.random()*17);
var str2 = ar[now];
document.write(\'<a href="http://testprof.msk.ru" target="_blank">\'+str2+\'</a>\');
</script>
      <noscript>
      <a href="http://testprof.msk.ru">Сертификация специалистов</a>
      </noscript></td>
    <td width="100"><table width="100" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td bgcolor="#C4C4FF">&nbsp;</td>
          <td bgcolor="#B0B0FF">&nbsp;</td>
          <td bgcolor="#9F9FFF">&nbsp;</td>
          <td bgcolor="#9191FF">&nbsp;</td>
          <td bgcolor="#6F6FFF">&nbsp;</td>
          <td bgcolor="#5151FF">&nbsp;</td>
          <td bgcolor="#1111FF">&nbsp;</td>
          <td bgcolor="#0000CC">&nbsp;</td>
          <td bgcolor="#00009B">&nbsp;</td>
          <td bgcolor="#00006A">&nbsp;</td>
        </tr>
      </table></td>
  </tr>
</table>

';
$strHtmEnd='

<!-- REKLAMA -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100"><table width="100" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td bgcolor="#00006A">&nbsp;</td>
          <td bgcolor="#00009B">&nbsp;</td>
          <td bgcolor="#0000CC">&nbsp;</td>
          <td bgcolor="#1111FF">&nbsp;</td>
          <td bgcolor="#5151FF">&nbsp;</td>
          <td bgcolor="#6F6FFF">&nbsp;</td>
          <td bgcolor="#9191FF">&nbsp;</td>
          <td bgcolor="#9F9FFF">&nbsp;</td>
          <td bgcolor="#B0B0FF">&nbsp;</td>
          <td bgcolor="#C4C4FF">&nbsp;</td>
        </tr>
      </table></td>
    <td align="center" bgcolor="#CCCCFF"><script language="javascript">
var str2;
var now = 0;
var ar=new Array("Сертификация&nbsp;специалистов",
"Аттестация&nbsp;персонала",
"Найди&nbsp;работу&nbsp;с&nbsp;сертификатом&nbsp;Профессионал",
"Центр&nbsp;тестирования&nbsp;on-line",
"Бесплатное&nbsp;тестирование&nbsp;MS&nbsp;Excel&nbsp;2007",
"Пройди&nbsp;тест&nbsp;MS&nbsp;Exсel2007&nbsp;и&nbsp;получи&nbsp;сертификат",
"Пройди&nbsp;тест&nbsp;MS&nbsp;Word&nbsp;2007&nbsp;и&nbsp;получи&nbsp;сертификат",
"Получи&nbsp;сертификат&nbsp;специалиста&nbsp;MS&nbsp;Excel&nbsp;2007",
"Получи&nbsp;сертификат&nbsp;специалиста&nbsp;MS&nbsp;Word&nbsp;2007",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Платформа&nbsp;8.1",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Бухгалтерия&nbsp;8",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Управление&nbsp;торговлей&nbsp;8",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Бухгалтерия&nbsp;7.7",
"Пройди&nbsp;тест&nbsp;и&nbsp;получи&nbsp;сертификат&nbsp;1C:Торговля&nbsp;и&nbsp;склад&nbsp;7.7",
"Проведите&nbsp;аттестацию&nbsp;своего&nbsp;персонала",
"Бесплатное&nbsp;тестирование&nbsp;при&nbsp;приеме&nbsp;на&nbsp;работу",
"Получи&nbsp;сертификат&nbsp;&quot;Профессионал&quot;&nbsp;и&nbsp;зарабатывай&nbsp;больше",
"Хочешь&nbsp;зарабатывать&nbsp;больше.&nbsp;Получи&nbsp;сертификат&nbsp;&quot;Профессионал&quot;"
);
now = Math.round(Math.random()*17);
var str2 = ar[now];
document.write(\'<a href="http://testprof.msk.ru" target="_blank">\'+str2+\'</a>\');
</script>
      <noscript>
      <a href="http://testprof.msk.ru">Сертификация специалистов</a>
      </noscript></td>
    <td width="100"><table width="100" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td bgcolor="#C4C4FF">&nbsp;</td>
          <td bgcolor="#B0B0FF">&nbsp;</td>
          <td bgcolor="#9F9FFF">&nbsp;</td>
          <td bgcolor="#9191FF">&nbsp;</td>
          <td bgcolor="#6F6FFF">&nbsp;</td>
          <td bgcolor="#5151FF">&nbsp;</td>
          <td bgcolor="#1111FF">&nbsp;</td>
          <td bgcolor="#0000CC">&nbsp;</td>
          <td bgcolor="#00009B">&nbsp;</td>
          <td bgcolor="#00006A">&nbsp;</td>
        </tr>
      </table></td>
  </tr>
</table>
</body>
</html>
';

// Создать миниатюру размер 160 х 120
function MakeMini($imageBig,$imageWidth=160,$imageHeight=120) {
$widthS = $imageWidth;
$heightS = $imageHeight;

$width = $widthS;
$height = $heightS;

$width_orig=imagesx($imageBig);
$height_orig=imagesy($imageBig);

$k0n1=$height / $height_orig;
$k0n2=$width / $width_orig;

if ($k0n1<$k0n2) {$k0tmp=$k0n1;} else {$k0tmp=$k0n2;}

$width = intval($k0tmp * $width_orig);
$height = intval($k0tmp * $height_orig);
// Resample
$image = $imageBig;
$image_p = imagecreatetruecolor($width,$height);
imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);
return $image_p;
}

// Создать миниатюру размер 160 х 120
function MakeMini2($imageBig,$imageWidth=160,$imageHeight=120) {
$widthS = $imageWidth;
$heightS = $imageHeight;

$width = $widthS;
$height = $heightS;

$width_orig=imagesx($imageBig);
$height_orig=imagesy($imageBig);

$k0n1=$height / $height_orig;
$k0n2=$width / $width_orig;

if ($k0n1>$k0n2) {$k0tmp=$k0n1;} else {$k0tmp=$k0n2;}

$width = intval($k0tmp * $width_orig);
$height = intval($k0tmp * $height_orig);
// Resample
$image = $imageBig;
$image_p = imagecreatetruecolor($width,$height);
imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);
return $image_p;
}

function ReadFilesDirInDir($dirname)
{
	$array_ret=array();
	if (is_dir($dirname))
		{
			if ($dh = opendir($dirname)) 
			{
				while (($file = readdir($dh)) !== false) 
				{
					if (($file=='.') || ($file=='..')) {continue;}
					if (is_dir($dirname.'/'.$file))
						{$array_ret[]=$dirname.'/'.$file;}
					//echo $file;
				}
				
			}
			else
			{echo 'Не могу открыть';return false;}
						
		}
		else {echo 'Не каталог';return false;}
	return $array_ret;	
}

function AddZero($strnum,$strlen) // Добавляет нули в начале строки пока не станет равна по длине $strlen
{
  $strret=$strnum;
  while(strlen($strret)<$strlen)
        {
        $strret='0'.$strret;
        }
  return $strret;
}

function ReadFilesInDir($dirname)
{
	$array_ret=array();
	if (is_dir($dirname))
		{
			if ($dh = opendir($dirname)) 
			{
				while (($file = readdir($dh)) !== false) 
				{
					if (($file=='.') || ($file=='..')) {continue;}
					if (!is_dir($dirname.'/'.$file))
						{$array_ret[]=$dirname.'/'.$file;}
					//echo $file;
				}
				
			}
			else
			{echo 'Не могу открыть';return false;}
						
		}
		else {echo 'Не каталог';return false;}
	return $array_ret;	
}

function GetFileExtFromUrl($url,$default_ext)
{
$curFileName=trim(basename($url));
if (strlen($curFileName)>0)
	{
		$curFileExt=strrchr($curFileName,".");if ($curFileDot===false) {$curFileExt=$default_ext;}
		if (strlen($curFileExt)>5) {$curFileExt=substr($curFileExt,0,5);}
	} else {$curFileExt=$default_ext;}
return $curFileExt;
}

// Функция возвращает все названия файлов в каталоге с указанным расширением
// Параметры:
// 		$fileCatalog - имя каталога
//		$fileExt - расширение файлов
//		$addFullPath - добавлять или нет к названию файлов полный путь к файлу
function ReturnAllFilesInDir($fileCatalog,$fileExt,$addFullPath=false,$findDir=false)
{
$fileList=array();
if (!is_dir($fileCatalog))
	{
	echo 'Это не каталог ';
	return false;
	}

if ($dh = opendir($fileCatalog))
  {
  while (($file = readdir($dh)) !== false)
      {
	      if (($file!='.') && ($file!='..'))
					{
					if ((is_file($fileCatalog.'/'.$file)) && ($findDir==false))
						{
							if (strlen($fileExt)>0)
								{
									if  (strpos($file,$fileExt)!==false)
										{
											if ($addFullPath)
												{$fileList[]=$fileCatalog.'/'.$file;}
												else
												{$fileList[]=$file;}
										}
								}
								else
								{	
									if ($addFullPath)
										{$fileList[]=$fileCatalog.'/'.$file;}
										else
										{$fileList[]=$file;}
								}
						}
					if ((is_dir($fileCatalog.'/'.$file)) && ($findDir==true))
						{
							if (strlen($fileExt)>0)
								{
									if  (strpos($file,$fileExt)!==false)
										{
											if ($addFullPath)
												{$fileList[]=$fileCatalog.'/'.$file;}
												else
												{$fileList[]=$file;}
										}
								}
								else
								{	
									if ($addFullPath)
										{$fileList[]=$fileCatalog.'/'.$file;}
										else
										{$fileList[]=$file;}
								}
						}
					}
      }
  closedir($dh);
  sort($fileList);
  reset($fileList);
  return $fileList;
  }
  else
  {
	echo 'Не могу открыть ';
  return false;
  }
}

function ReturnAllDirFilesInDir($fileCatalog)
{
$fileList=array();
if (!is_dir($fileCatalog)) {return false;}

if ($dh = opendir($fileCatalog))
  {
  while (($file = readdir($dh)) !== false)
      {
      if (($file!='.') && ($file!='..') && (is_dir($fileCatalog.'/'.$file)))
                    {$fileList[]=$file;}
      }
  closedir($dh);
  sort($fileList);
  reset($fileList);
  return $fileList;
  }
  else
  {return false;}
}

function ObrabotkaCommand($reg_c,$reg_dir)
{
GLOBAL $sql_host,$sql_user,$sql_pass,$sql_db_name,$page_body_text,$fileprefix;
$text_save='';
$num_save_file=0;

if (is_dir($reg_dir)) {
	if ($dh = opendir($reg_dir)) {
		while (($file = readdir($dh)) !== false) {
			if (($file=='.') || ($file=='..'))
				{continue;} 
		
			if ($reg_c=='1')
				{
					$page_body_text .= $fileprefix.$reg_dir.'/'.$file ."<br>\r\n";
					$text_save.=$fileprefix.$reg_dir.'/'.$file ."\r\n";
				}
				
			if ($reg_c=='1b')
				{
					$page_body_text .= '<img src="'.$reg_dir.'/'.$file.'">'."\r\n";
				}
				
			if ($reg_c=='1c')
				{
					$page_body_text .= htmlspecialchars('<img src="'.$reg_dir.'/'.$file.'">')."<br>\r\n";
				}
				
			if ($reg_c=='1a')
				{
					$num_save_file++; 
					$text_save.=$fileprefix.$reg_dir.'/'.$file ."\r\n";
				}
				
			if ($reg_c=='2')
				{
					$page_body_text .= '<a href="'.$file.'">'.$file.'</a><br>'."\r\n";
				}
			if ($reg_c=='3')
				{
					$page_body_text .= $reg_dir.'/'.$file.' '.md5_file($reg_dir.'/'.$file).'<br>'."\r\n";
				}
			if ($reg_c=='4')
				{
					$fileArr[]=array($reg_dir.'/'.$file,md5_file($reg_dir.'/'.$file));
					$page_body_text .= $reg_dir.'/'.$file.' '.md5_file($reg_dir.'/'.$file).'<br>'."\r\n";
				}
		}
		closedir($dh);
	}
if ($text_save!='')
	{
		$fh=fopen('filelist.txt','wb');
		fwrite($fh,$text_save);
		fclose($fh);
		if ($reg_c=='1a')
			{
				$page_body_text .= "Записано в список $num_save_file файл(ов) filelist.txt <br>\r\n";	
			}
	}
	else
	{
		@unlink('filelist.txt');
		if ($reg_c=='1a')
			{
				$page_body_text .= "Список пуст <br>\r\n";	
			}
	}
}
if ($reg_c=='4')
	{
		include('config2.inc');
		include('funcmysqlclass.php');
		$sql=new sql_db($sql_host,$sql_user,$sql_pass,$sql_db_name);
		$sql->SaveArrayToTable($fileArr,'filelist');
		$sql->sql_close();
	}
	

if ($page_body_text=='') {$page_body_text='Список пуст';}
}

function DeletaFileList()
{
GLOBAL $page_body_text;
$file_name_arr=@file('filelist.txt');
if ($file_name_arr==false)
	{$page_body_text.='Ошибка чтения списка файлов filelist.txt';return;}
$num_files=0;
$page_body_error='';
foreach($file_name_arr as $file_name)
	{
		if (@unlink(trim($file_name)))
			{
				$num_files++;
			}
			else
			{
				$page_body_error.= "$file_name <br>\r\n";
			}
	}
	
$page_body_text.= "Удалены $num_files файл(ов) <br>\r\n";
if ($page_body_error!='')
	{
		$page_body_text.= "Не смогли удалить следущие файлы <br>\r\n".$page_body_error;
	}
}

function DeletaFileS($reg_dir,$arrFile)
{
GLOBAL $page_body_text;
$page_body_error='';
$num_files=0;
foreach ($arrFile as $filename)
	{
	if (@unlink($reg_dir.'/'.$filename))	{$num_files++;}
		else {$page_body_error.= $reg_dir.'/'.$filename." <br>\r\n";}
	}
$page_body_text.= "Удалены $num_files файл(ов) <br>\r\n";
if ($page_body_error!='')
	{
		$page_body_text.= "Не смогли удалить следущие файлы <br>\r\n".$page_body_error;
	}
}

function RenameFilesArray($reg_dir,$reg_dir2,$arrFile)
{
GLOBAL $page_body_text;
$page_body_error='';
$num_files=0;
foreach ($arrFile as $filename)
	{
	if (rename($reg_dir.'/'.$filename,$reg_dir2.'/'.$filename))
		{
		$num_files++;
		}
		else
		{
		$page_body_error.= $reg_dir.'/'.$filename." <br>\r\n";
		}
	}
$page_body_text.= "Перенесены файлы $num_files файл(ов) <br>\r\n";
if ($page_body_error!='')
	{
		$page_body_text.= "Не смогли перенести следущие файлы <br>\r\n".$page_body_error;
	}
}

function DecodeDzFiles($reg_dir,$arrDir)
{
	$n=0;
	foreach ($arrDir as $dirname)
		{
			$n++;
			if ($n>100) {exit;}
			$fh=fopen($reg_dir.'/'.$dirname,'rb');
			$fh2=fopen($reg_dir.'/'.str_replace('.dz','.jpg',$dirname),'wb');
			for ($a=0;$a<filesize($reg_dir.'/'.$dirname);$a++)
				{
					$s=fread($fh,1);
					$s2=chr(ord($s)-1);
					fwrite($fh2,$s2);
				}
			fclose($fh);fclose($fh2);
			$page_body_text.= $dirname."<br>\r\n";
			unlink($reg_dir.'/'.$dirname);
		}
}

function SaveArrayToFile($curarray,$fname)
{
	if (count($curarray)>0)
		{
			$fh=fopen($fname,'wb');
			foreach($curarray as $row)
				{fwrite($fh,trim($row)."\r\n");}
			fclose($fh);
		}
}

// Изменяет теги в соответствии с правилами 1 - удалить все символы которые не печатные
// Удалить повторяющиеся пробелы
// Меньше 3 символов слова удалять
function tag_replace($str_tag,$num_tags=0,$min_tag_len=4) 
{ 
	$fail=0; 
	//$pattern="/[^(\w)|(\x7F-\xFF)|(\s)]/";
	$pattern="/[^(\x30-\x39)|(\x41-\x5A)|(\x61-\x7A)|(\xC0-\xFF)]/";
	$str_tag2=preg_replace($pattern,' ',$str_tag); // Заменить все символы которые не являются словами на пробелы
	$str_tag2=preg_replace("/[(\x28-\x29)]/",' ',$str_tag2);
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=preg_replace("/  +/"," ",$str_tag2); // Удалить повторяющиеся пробелы - вместо Х поставьте пробел 
	$str_tag2=trim($str_tag2);
	$array_tag=explode(' ',$str_tag2);
	$str_tag3='';
	$cur_tags=0;
	foreach($array_tag as $val) 
		{
			if ($num_tags==0)
				{
					if (strlen($val)>=$min_tag_len) {$str_tag3.=$val.' ';}
				}
				else
				{
					if ($cur_tags<$num_tags)
						{
							if (strlen($val)>=$min_tag_len) {$str_tag3.=$val.' ';}
						}
					$cur_tags++;
				}
		}
	return trim($str_tag3); 
}
